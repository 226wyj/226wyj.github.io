<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Leetcode 138. Copy List with Random Pointer &mdash; Wu</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="canonical" href="https://226wyj.github.io/2021/12/28/Leetcode-138/"><link rel="alternate" type="application/atom+xml" title="Wu" href="https://226wyj.github.io/feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/favicon.ico"><meta property="og:title" content="Leetcode 138. Copy List with Random Pointer"><meta name="keywords" content="Leetcode, Linked List"><meta name="og:keywords" content="Leetcode, Linked List"><meta name="description" content="Problem Link"><meta name="og:description" content="Problem Link"><meta property="og:url" content="https://226wyj.github.io/2021/12/28/Leetcode-138/"><meta property="og:site_name" content="Wu"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2021-12-28"> <script src="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://226wyj.github.io/" title="Wu"><span class="octicon octicon-mark-github"></span> Wu</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://226wyj.github.io/" class=" site-header-nav-item" target="" title="Home">Home</a> <a href="https://226wyj.github.io/categories/" class=" site-header-nav-item" target="" title="Categories">Categories</a> <a href="https://226wyj.github.io/wiki/" class=" site-header-nav-item" target="" title="Wiki">Wiki</a> <a href="https://226wyj.github.io/links/" class=" site-header-nav-item" target="" title="Link">Link</a> <a href="https://226wyj.github.io/about/" class=" site-header-nav-item" target="" title="About">About</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Leetcode 138. C"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Leetcode 138. Copy List with Random Pointer</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2021/12/28 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://226wyj.github.io/categories/#Leetcode" title="Leetcode">Leetcode</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 2513 字，约 8 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><p><a href="https://leetcode.com/problems/copy-list-with-random-pointer/">Problem Link</a></p><h2 id="problem-description">Problem Description</h2><p>A linked list of length n is given such that each node contains an additional random pointer, which could point to any node in the list, or null.</p><p>Construct a deep copy of the list. The deep copy should consist of exactly n brand new nodes, where each new node has its value set to the value of its corresponding original node. Both the next and random pointer of the new nodes should point to new nodes in the copied list such that the pointers in the original list and copied list represent the same list state. None of the pointers in the new list should point to nodes in the original list.</p><p>For example, if there are two nodes X and Y in the original list, where X.random –&gt; Y, then for the corresponding two nodes x and y in the copied list, x.random –&gt; y.</p><p>Return the head of the copied linked list.</p><p>The linked list is represented in the input/output as a list of n nodes. Each node is represented as a pair of [val, random_index] where:</p><p>val: an integer representing Node.val random_index: the index of the node (range from 0 to n-1) that the random pointer points to, or null if it does not point to any node. Your code will only be given the head of the original linked list.</p><h2 id="example">Example</h2><p><img src="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/images/leetcode/138.png" alt="" /></p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Input: head = [[7,null],[13,0],[11,4],[10,2],[1,0]]
Output: [[7,null],[13,0],[11,4],[10,2],[1,0]]
</code></pre></div></div><h2 id="solution">Solution</h2><p><strong>Solution 1. HashMap</strong></p><ol><li>Use a hash map to store the corresponding copied node with the original node.</li><li>Reiterate the original linked list, link the random pointers of the copied nodes.</li><li>Return the new head.</li></ol><p>Time Complexity: O(n)</p><p>Space Complexity: O(n)</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""
# Definition for a Node.
class Node:
    def __init__(self, x: int, next: 'Node' = None, random: 'Node' = None):
        self.val = int(x)
        self.next = next
        self.random = random
"""</span>
<span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">copyRandomList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head</span><span class="p">:</span> <span class="s">'Node'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s">'Node'</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">head</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
        <span class="n">curr</span> <span class="o">=</span> <span class="n">head</span>
        <span class="c1"># k: original node
</span>        <span class="c1"># v: copied node
</span>        <span class="n">hash_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="n">curr</span><span class="p">:</span>
            <span class="n">hash_map</span><span class="p">[</span><span class="n">curr</span><span class="p">]</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">val</span><span class="p">)</span>
            <span class="n">curr</span> <span class="o">=</span> <span class="n">curr</span><span class="p">.</span><span class="nb">next</span>

        <span class="n">curr</span> <span class="o">=</span> <span class="n">head</span>
        <span class="k">while</span> <span class="n">curr</span><span class="p">:</span>
            <span class="n">hash_map</span><span class="p">[</span><span class="n">curr</span><span class="p">].</span><span class="nb">next</span> <span class="o">=</span> <span class="n">hash_map</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="nb">next</span><span class="p">)</span>
            <span class="n">hash_map</span><span class="p">[</span><span class="n">curr</span><span class="p">].</span><span class="n">random</span> <span class="o">=</span> <span class="n">hash_map</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">random</span><span class="p">)</span>
            <span class="n">curr</span> <span class="o">=</span> <span class="n">curr</span><span class="p">.</span><span class="nb">next</span>
        
        <span class="k">return</span> <span class="n">hash_map</span><span class="p">[</span><span class="n">head</span><span class="p">]</span>
</code></pre></div></div><p><strong>Solution 2. Inplace opeartion</strong></p><ol><li>Copy each node and link the copied node right behind the corresponding original node. For example, 1 → 2 → 3 would become 1 → 1’ → 2 → 2’ → 3 → 3’.</li><li>Link the copied node’s random pointer.</li><li>Divide the original nodes and the copied nodes into two linked lists, and the second one is what we want.</li></ol><p>Time Complexity: O(n)</p><p>Space Complexity: O(1)</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">copyRandomList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head</span><span class="p">:</span> <span class="s">'Node'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s">'Node'</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">head</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
        <span class="c1"># copy 
</span>        <span class="n">node</span><span class="p">,</span> <span class="n">node_copy</span> <span class="o">=</span> <span class="n">head</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">node_copy</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">val</span><span class="p">)</span>
            <span class="n">node_copy</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span>
            <span class="n">node</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">node_copy</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node_copy</span><span class="p">.</span><span class="nb">next</span>
        <span class="c1"># link the copied node's random pointer
</span>        <span class="n">node</span> <span class="o">=</span> <span class="n">head</span>
        <span class="k">while</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">random</span><span class="p">:</span>
                <span class="n">node</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">random</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nb">next</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="nb">next</span>
        <span class="c1"># divide
</span>        <span class="n">new_head</span> <span class="o">=</span> <span class="n">head</span><span class="p">.</span><span class="nb">next</span>
        <span class="n">node</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">head</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="n">node</span> <span class="ow">and</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span>
            <span class="n">node</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="nb">next</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">tmp</span>

        <span class="k">return</span> <span class="n">new_head</span>
</code></pre></div></div><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://226wyj.github.io" target="_blank">Wu, Yuejiang</a></li><li>本文链接：<a href="https://226wyj.github.io/2021/12/28/Leetcode-138/" target="_blank">https://226wyj.github.io/2021/12/28/Leetcode-138/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2021/12/28/Leetcode-138/', clientID: '816a74632f6a9e1d895c', clientSecret: '69da216c45ee48df2f0e92506cf044cbc001ef2b', repo: 'blog-comment', owner: '226wyj', admin: ['226wyj'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://226wyj.github.io/assets/search_data.json?v=1701450611', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2015 <span title="Wu, Yuejiang">Wu, Yuejiang</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/226wyj/226wyj.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://226wyj.github.io/" title="Home" target="">Home</a></li><li> <a href="https://226wyj.github.io/categories/" title="Categories" target="">Categories</a></li><li> <a href="https://226wyj.github.io/wiki/" title="Wiki" target="">Wiki</a></li><li> <a href="https://226wyj.github.io/links/" title="Link" target="">Link</a></li><li> <a href="https://226wyj.github.io/about/" title="About" target="">About</a></li><li><a href="https://226wyj.github.io/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/226wyj/226wyj.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80669434-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
